<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Exersio</title>
  </head>
  <body>
    <div id="root"></div>

    <!-- Android WebView tap stability fixes -->
    <script>
      // Detect backdrop-filter support
      (function () {
        var supportsBackdrop = (CSS && CSS.supports &&
          (CSS.supports('backdrop-filter', 'blur(1px)') ||
           CSS.supports('-webkit-backdrop-filter', 'blur(1px)')));
        if (!supportsBackdrop) {
          document.documentElement.classList.add('no-backdrop');
        }
      })();

      // Delegated touch-to-click handler for reliable touch events on Android
      (function () {
        var startX = 0, startY = 0, startedOn;

        // Use touchstart/touchend for better Android WebView compatibility
        document.addEventListener('touchstart', function (e) {
          if (e.touches.length > 0) {
            startedOn = e.target;
            startX = e.touches[0].clientX;
            startY = e.touches[0].clientY;
          }
        }, { passive: true, capture: true });

        document.addEventListener('touchend', function (e) {
          if (!startedOn) return;

          // Check if finger moved (detect swipe vs tap)
          var touch = e.changedTouches[0];
          if (touch) {
            var dx = touch.clientX - startX;
            var dy = touch.clientY - startY;
            var moved = (dx*dx + dy*dy) > (12*12);

            if (moved) {
              startedOn = null;
              return;
            }
          }

          // Find clickable element
          var el = startedOn;
          while (el && el !== document) {
            if (el.disabled) {
              el = el.parentElement;
              continue;
            }

            if (el.tagName === 'BUTTON' || el.tagName === 'A' ||
                el.getAttribute('role') === 'button' ||
                el.classList.contains('cursor-pointer') ||
                el.dataset.clickable === 'true') {

              // Prevent default touch behavior and stop propagation
              e.preventDefault();
              e.stopPropagation();

              // Trigger click event
              el.click();

              console.log('[TouchFix] Click triggered on:', el.tagName, el.className);
              break;
            }
            el = el.parentElement;
          }
          startedOn = null;
        }, { passive: false, capture: true });
      })();
    </script>

    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
